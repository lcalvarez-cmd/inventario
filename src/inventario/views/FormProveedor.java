package inventario.views;

import java.sql.ResultSet;

import inventario.config.Conexion;
import inventario.modelo.DatosContacto;
import inventario.modelo.Producto;
import inventario.modelo.Proveedor;
import inventario.tabla.CeldaRenderer;
import inventario.tabla.EncabezadoRenderer;
import inventario.tabla.TablaModelo;
import java.util.ArrayList;
import javax.swing.JOptionPane;
import javax.swing.JTable;
import javax.swing.table.DefaultTableModel;
import javax.swing.table.TableColumnModel;

public class FormProveedor extends javax.swing.JFrame {
    DefaultTableModel model;
    DefaultTableModel modelProductos;

    ArrayList<Proveedor> listProveedores;
    Proveedor proveedorEditar ;
    Producto productoAgregar;
//    private JComboBox combo;
//    private JTextField tf;

    /**
     * Creates new form FormProveedor
     */
    public FormProveedor() {
        initComponents();
        setLocationRelativeTo(null);
        String[] tituos = {"ID_PROVEEDOR", "NIT", "NOMBRE", "DIRECCIÓN", "TELEFONO", "PRODUCTOS"};
        String [] tituloProductos = {"ID_PRODUCTO","CODIGO","NOMBRE"};

        txtIdProveedor.setVisible(false);
        model = new DefaultTableModel(null, tituos);
        modelProductos = new DefaultTableModel(null, tituloProductos);
        tblProveedores.setModel(model);
        tblProductos.setModel(modelProductos);
        cargarDatos();
        cargarProductos();
//        iniciarTabla(); //metodo que podria ir mejor para visibilizar los datos
        //ocultamos la columna 0 id_proveedor
        tblProveedores.removeColumn(tblProveedores.getColumnModel().getColumn(0));
        limpiar();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        btnVolver = new javax.swing.JButton();
        jScrollPane1 = new javax.swing.JScrollPane();
        tblProveedores = new javax.swing.JTable();
        pnlAgregarProveedor = new javax.swing.JPanel();
        jLabel7 = new javax.swing.JLabel();
        txtDireccionUno = new javax.swing.JTextField();
        btnEditar = new javax.swing.JButton();
        txtTelefonoUno = new javax.swing.JTextField();
        txtIdProveedor = new javax.swing.JTextField();
        txtDireccionDos = new javax.swing.JTextField();
        txtTelefonoDos = new javax.swing.JTextField();
        btnAgregar = new javax.swing.JButton();
        jLabel4 = new javax.swing.JLabel();
        jLabel10 = new javax.swing.JLabel();
        txtNit = new javax.swing.JTextField();
        jLabel1 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        btnCancelar = new javax.swing.JButton();
        txtNombre = new javax.swing.JTextField();
        pnlAgregarProductos = new javax.swing.JPanel();
        jLabel8 = new javax.swing.JLabel();
        jLabel9 = new javax.swing.JLabel();
        txtCodigoProducto = new javax.swing.JTextField();
        btnAgregarProducto = new javax.swing.JButton();
        jButton2 = new javax.swing.JButton();
        jScrollPane2 = new javax.swing.JScrollPane();
        tblProductos = new javax.swing.JTable();

        setDefaultCloseOperation(javax.swing.WindowConstants.EXIT_ON_CLOSE);

        btnVolver.setText("volver");
        btnVolver.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnVolverActionPerformed(evt);
            }
        });

        tblProveedores.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        tblProveedores.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tblProveedoresMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(tblProveedores);

        pnlAgregarProveedor.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        jLabel7.setText("Dirección 2:");

        btnEditar.setText("Editar");
        btnEditar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnEditarActionPerformed(evt);
            }
        });

        txtTelefonoUno.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txtTelefonoUnoKeyTyped(evt);
            }
        });

        txtTelefonoDos.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyTyped(java.awt.event.KeyEvent evt) {
                txtTelefonoDosKeyTyped(evt);
            }
        });

        btnAgregar.setText("Agregar");
        btnAgregar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAgregarActionPerformed(evt);
            }
        });

        jLabel4.setText("Telefono 1:");

        jLabel10.setText("Información de contacto:");

        jLabel1.setText("Agregar nuevo proveedor:");

        jLabel5.setText("Dirección 1:");

        jLabel2.setText("Nombre:");

        jLabel6.setText("Telefono 2:");

        jLabel3.setText("Nit");

        btnCancelar.setText("Cancelar");
        btnCancelar.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnCancelarActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout pnlAgregarProveedorLayout = new javax.swing.GroupLayout(pnlAgregarProveedor);
        pnlAgregarProveedor.setLayout(pnlAgregarProveedorLayout);
        pnlAgregarProveedorLayout.setHorizontalGroup(
            pnlAgregarProveedorLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnlAgregarProveedorLayout.createSequentialGroup()
                .addContainerGap()
                .addGroup(pnlAgregarProveedorLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(pnlAgregarProveedorLayout.createSequentialGroup()
                        .addComponent(btnAgregar)
                        .addGap(91, 91, 91)
                        .addComponent(btnCancelar)
                        .addGap(98, 98, 98)
                        .addComponent(btnEditar))
                    .addGroup(pnlAgregarProveedorLayout.createSequentialGroup()
                        .addGap(24, 24, 24)
                        .addGroup(pnlAgregarProveedorLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(pnlAgregarProveedorLayout.createSequentialGroup()
                                .addGroup(pnlAgregarProveedorLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jLabel4)
                                    .addComponent(jLabel5)
                                    .addComponent(jLabel6)
                                    .addComponent(jLabel7))
                                .addGap(69, 69, 69)
                                .addGroup(pnlAgregarProveedorLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                    .addComponent(txtTelefonoDos)
                                    .addComponent(txtTelefonoUno)
                                    .addComponent(txtDireccionUno)
                                    .addComponent(txtDireccionDos, javax.swing.GroupLayout.PREFERRED_SIZE, 97, javax.swing.GroupLayout.PREFERRED_SIZE)))
                            .addGroup(pnlAgregarProveedorLayout.createSequentialGroup()
                                .addGroup(pnlAgregarProveedorLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                                    .addComponent(jLabel2)
                                    .addComponent(jLabel3))
                                .addGap(75, 75, 75)
                                .addGroup(pnlAgregarProveedorLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                                    .addComponent(txtNombre)
                                    .addComponent(txtNit, javax.swing.GroupLayout.PREFERRED_SIZE, 135, javax.swing.GroupLayout.PREFERRED_SIZE)))
                            .addGroup(pnlAgregarProveedorLayout.createSequentialGroup()
                                .addGap(33, 33, 33)
                                .addComponent(jLabel1)
                                .addGap(26, 26, 26)
                                .addComponent(txtIdProveedor, javax.swing.GroupLayout.PREFERRED_SIZE, 50, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addComponent(jLabel10))))
                .addContainerGap(8, Short.MAX_VALUE))
        );
        pnlAgregarProveedorLayout.setVerticalGroup(
            pnlAgregarProveedorLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnlAgregarProveedorLayout.createSequentialGroup()
                .addGroup(pnlAgregarProveedorLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel1)
                    .addComponent(txtIdProveedor, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(18, 18, 18)
                .addGroup(pnlAgregarProveedorLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel2)
                    .addComponent(txtNombre, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(3, 3, 3)
                .addGroup(pnlAgregarProveedorLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel3)
                    .addComponent(txtNit, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addComponent(jLabel10)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(pnlAgregarProveedorLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtTelefonoUno, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel4))
                .addGap(3, 3, 3)
                .addGroup(pnlAgregarProveedorLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtDireccionUno, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel5))
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                .addGroup(pnlAgregarProveedorLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtTelefonoDos, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel6))
                .addGap(3, 3, 3)
                .addGroup(pnlAgregarProveedorLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(txtDireccionDos, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                    .addComponent(jLabel7))
                .addGap(39, 39, 39)
                .addGroup(pnlAgregarProveedorLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnCancelar)
                    .addComponent(btnEditar)
                    .addComponent(btnAgregar))
                .addGap(0, 0, Short.MAX_VALUE))
        );

        pnlAgregarProductos.setBorder(javax.swing.BorderFactory.createEtchedBorder());

        jLabel8.setText("Productos del proveedor");

        jLabel9.setText("Codigo:");

        btnAgregarProducto.setText("Agregar Producto");
        btnAgregarProducto.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnAgregarProductoActionPerformed(evt);
            }
        });

        jButton2.setText("Retirar Producto");

        tblProductos.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null},
                {null, null, null, null}
            },
            new String [] {
                "Title 1", "Title 2", "Title 3", "Title 4"
            }
        ));
        tblProductos.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tblProductosMouseClicked(evt);
            }
        });
        jScrollPane2.setViewportView(tblProductos);

        javax.swing.GroupLayout pnlAgregarProductosLayout = new javax.swing.GroupLayout(pnlAgregarProductos);
        pnlAgregarProductos.setLayout(pnlAgregarProductosLayout);
        pnlAgregarProductosLayout.setHorizontalGroup(
            pnlAgregarProductosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnlAgregarProductosLayout.createSequentialGroup()
                .addGroup(pnlAgregarProductosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(pnlAgregarProductosLayout.createSequentialGroup()
                        .addGap(33, 33, 33)
                        .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                    .addGroup(pnlAgregarProductosLayout.createSequentialGroup()
                        .addGap(147, 147, 147)
                        .addGroup(pnlAgregarProductosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addGroup(pnlAgregarProductosLayout.createSequentialGroup()
                                .addComponent(btnAgregarProducto)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED)
                                .addComponent(jButton2))
                            .addGroup(pnlAgregarProductosLayout.createSequentialGroup()
                                .addGap(53, 53, 53)
                                .addComponent(jLabel9)
                                .addGap(31, 31, 31)
                                .addComponent(txtCodigoProducto, javax.swing.GroupLayout.PREFERRED_SIZE, 100, javax.swing.GroupLayout.PREFERRED_SIZE))
                            .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, pnlAgregarProductosLayout.createSequentialGroup()
                                .addComponent(jLabel8)
                                .addGap(38, 38, 38)))))
                .addContainerGap(59, Short.MAX_VALUE))
        );
        pnlAgregarProductosLayout.setVerticalGroup(
            pnlAgregarProductosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(pnlAgregarProductosLayout.createSequentialGroup()
                .addContainerGap()
                .addComponent(jLabel8)
                .addGap(18, 18, 18)
                .addGroup(pnlAgregarProductosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(jLabel9)
                    .addComponent(txtCodigoProducto, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                .addGap(34, 34, 34)
                .addGroup(pnlAgregarProductosLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                    .addComponent(btnAgregarProducto)
                    .addComponent(jButton2))
                .addGap(18, 18, 18)
                .addComponent(jScrollPane2, javax.swing.GroupLayout.PREFERRED_SIZE, 163, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addContainerGap(15, Short.MAX_VALUE))
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                    .addGroup(layout.createSequentialGroup()
                        .addGap(86, 86, 86)
                        .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                            .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 907, javax.swing.GroupLayout.PREFERRED_SIZE)
                            .addGroup(layout.createSequentialGroup()
                                .addComponent(pnlAgregarProveedor, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addGap(18, 18, 18)
                                .addComponent(pnlAgregarProductos, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))))
                    .addGroup(layout.createSequentialGroup()
                        .addGap(23, 23, 23)
                        .addComponent(btnVolver)))
                .addContainerGap(32, Short.MAX_VALUE))
        );
        layout.setVerticalGroup(
            layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
            .addGroup(layout.createSequentialGroup()
                .addGap(23, 23, 23)
                .addGroup(layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING, false)
                    .addComponent(pnlAgregarProveedor, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                    .addComponent(pnlAgregarProductos, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                .addGap(31, 31, 31)
                .addComponent(jScrollPane1, javax.swing.GroupLayout.PREFERRED_SIZE, 263, javax.swing.GroupLayout.PREFERRED_SIZE)
                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                .addComponent(btnVolver)
                .addContainerGap(22, Short.MAX_VALUE))
        );

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void btnCancelarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnCancelarActionPerformed
        limpiar();
    }//GEN-LAST:event_btnCancelarActionPerformed

    private void btnEditarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnEditarActionPerformed
        Conexion objConexion = new Conexion();
        Proveedor objProveedor = recuperarDatosGUI();
        try {
            ResultSet respuesta = objConexion.consultarRegistro("SELECT * FROM proveedor WHERE id_proveedor = "+objProveedor.getId_proveedor());
            String nit = "";
            while(respuesta.next()){// recupero el nit actual del id del proveedor
                //para ver si cambia, si cambia tengo que verificar que este disponible
                //si no cambia entonces no hago nada
                nit = respuesta.getString("nit");
            }
            System.out.println("nit: "+nit);
            if (!objProveedor.getNit().equals(nit)) {// si el nit se cambia verificamos que este disponible
                ResultSet nitbd = objConexion.consultarRegistro("SELECT * FROM proveedor WHERE nit = '"+objProveedor.getNit()+"'");
                if(nitbd.isBeforeFirst()){//entonces si hay un nit ya registrado con ese nit nuevo
                    JOptionPane.showMessageDialog(null, "Este Nit ya se encuentra registrado");
                }
            }else{
                String sentencia = String.format("UPDATE proveedor SET nit = '%s', nombre = '%s' where id_proveedor = %d" ,objProveedor.getNit(), objProveedor.getNombre(),objProveedor.getId_proveedor());
                objConexion.ejecutarSentenciSQL(sentencia);
                this.cargarDatos();
            }
            objConexion.desconectar();
        } catch (Exception e) {
            System.out.println("Error: editando proveedor "+e);
        }
        
    }//GEN-LAST:event_btnEditarActionPerformed

    private void btnVolverActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnVolverActionPerformed
        Inventario vistaIntenvario = new Inventario();//creo un objeto de la sigte vista
        vistaIntenvario.setVisible(true);//la hago visible
        setVisible(false);//oculto la vista de login
    }//GEN-LAST:event_btnVolverActionPerformed

    private void btnAgregarActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAgregarActionPerformed
        Conexion objConexion = new Conexion();
        Proveedor objProveedor = recuperarDatosGUI();
        try {
            //verificamos que el nit ya no este registrado
            ResultSet respuesta = objConexion.consultarRegistro("Select * from proveedor where nit = '" + objProveedor.getNit() + "'");
            if (!respuesta.isBeforeFirst()) {//si este nit no esta en la bd
                String sentenciauno = String.format("INSERT INTO proveedor (nombre,nit) VALUES ('%s','%s')", objProveedor.getNombre(), objProveedor.getNit());
                objConexion.ejecutarSentenciSQL(sentenciauno);//se crea el proveedor 
                respuesta = objConexion.consultarRegistro("Select * from proveedor where nit = '" + objProveedor.getNit() + "'");
                long id_proveedor = 0;
                while (respuesta.next()) {//obtengo el id para agregar los datos el id
                    id_proveedor = Long.parseLong(respuesta.getString("id_proveedor"));
                }
                for (int i = 0; i < objProveedor.getDatos().size(); i++) {
                    String sentenciados = String.format("INSERT INTO datoscontacto (telefono,direccion,id_proveedor) VALUES ('%d','%s','%d')", objProveedor.getDatos().get(i).getTelefono(), objProveedor.getDatos().get(i).getDireccion(), id_proveedor);
                    objConexion.ejecutarSentenciSQL(sentenciados);
                }
            } else {
                JOptionPane.showMessageDialog(null, "NIT ya registrado");
            }
        } catch (Exception e) {
            System.out.println("Error al insertar proveedor");
        }
        cargarDatos();
    }//GEN-LAST:event_btnAgregarActionPerformed

    private void tblProveedoresMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblProveedoresMouseClicked
        proveedorEditar = new Proveedor();
        Conexion objConexion = new Conexion();
        if (evt.getClickCount() == 1) {
            try {
                JTable receptor = (JTable) evt.getSource();
                //capturamos el id para buscar los datos ya que los telefonos direcciones y productos estan concatenados
                //dela columna 0 que esta oculta
                System.out.println("id:" + receptor.getModel().getValueAt(receptor.getSelectedRow(), 0)+":");
                String idS = (String) receptor.getModel().getValueAt(receptor.getSelectedRow(), 0);
                long id = Long.parseLong(idS);
                proveedorEditar.setId_proveedor(id);
                ResultSet respuestaProveedor = objConexion.consultarRegistro("SELECT * FROM proveedor where id_proveedor = "+id);
                while(respuestaProveedor.next()){
                    proveedorEditar.setId_proveedor(Long.parseLong(respuestaProveedor.getString("id_proveedor")));
                    proveedorEditar.setNombre(respuestaProveedor.getString("nombre"));
                    proveedorEditar.setNit(respuestaProveedor.getString("nit"));
                    
                    ResultSet respuestadatos = objConexion.consultarRegistro("SELECT * FROM datoscontacto where id_proveedor = " + id);
                    while (respuestadatos.next()) {//ahora recorremos uno a uno los datos que tenga ese proveedor 
                        DatosContacto datos = new DatosContacto();//llenamos los datos en el objeto
                        datos.setTelefono(Long.parseLong(respuestadatos.getString("telefono")));
                        datos.setDireccion(respuestadatos.getString("direccion"));
                        proveedorEditar.agregarDatos(datos); // lo agregamos al objeto programador 
                    }
                }
                
//                System.out.println("Prveedor "+proveedor.getId_proveedor());
                txtIdProveedor.setText(""+proveedorEditar.getId_proveedor());
                txtNit.setText(proveedorEditar.getNit());
                txtNombre.setText(proveedorEditar.getNombre());
                txtTelefonoUno.setText(""+proveedorEditar.getDatos().get(1).getTelefono());
                txtDireccionUno.setText(proveedorEditar.getDatos().get(1).getDireccion());
                txtTelefonoDos.setText(""+proveedorEditar.getDatos().get(0).getTelefono());
                txtDireccionDos.setText(proveedorEditar.getDatos().get(0).getDireccion());
                btnAgregar.setEnabled(false);
                btnEditar.setEnabled(true);
                btnCancelar.setEnabled(true);
            } catch (Exception e) {
                System.out.println("Error al querer montar los datos al dar click "+e);
            }
        }
        
        objConexion.desconectar();
    }//GEN-LAST:event_tblProveedoresMouseClicked

    //para solo recibir numeros
    private void txtTelefonoUnoKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtTelefonoUnoKeyTyped
        char caracter = evt.getKeyChar();
        // Verificar si la tecla pulsada no es un digito
        if (((caracter < '0')
                || (caracter > '9'))
                && (caracter != '\b' /*corresponde a BACK_SPACE*/)) {
            evt.consume();  // ignorar el evento de teclado
        }
    }//GEN-LAST:event_txtTelefonoUnoKeyTyped

//para solo recibir numeros
    private void txtTelefonoDosKeyTyped(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_txtTelefonoDosKeyTyped
        char caracter = evt.getKeyChar();
        // Verificar si la tecla pulsada no es un digito
        if (((caracter < '0')
                || (caracter > '9'))
                && (caracter != '\b' /*corresponde a BACK_SPACE*/)) {
            evt.consume();  // ignorar el evento de teclado
        }
    }//GEN-LAST:event_txtTelefonoDosKeyTyped

    private void tblProductosMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tblProductosMouseClicked
        if(evt.getClickCount() == 1){
            try {
                JTable receptor = (JTable)evt.getSource();
                txtCodigoProducto.setText(receptor.getModel().getValueAt(receptor.getSelectedRow(), 1).toString());
            } catch (Exception e) {
            }
        }
    }//GEN-LAST:event_tblProductosMouseClicked

    private void btnAgregarProductoActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btnAgregarProductoActionPerformed
        String codProducto = txtCodigoProducto.getText();
        try {
            Conexion objConexion = new Conexion();
            objConexion.conectar();
            ResultSet respuesta = objConexion.consultarRegistro("Select * from producto where codigo = '"+codProducto+ "'");
            while(respuesta.next()){
                productoAgregar = new Producto();
                productoAgregar.setId_producto(Long.parseLong(respuesta.getString("id_producto")));
            }
            String sentencia = "INSERT INTO proveedorproducto (producto_id,proveedor_id) VALUES ('"+productoAgregar.getId_producto()+"','"+proveedorEditar.getId_proveedor()+"')";
            System.out.println("Sentencia: "+sentencia);
            objConexion.ejecutarSentenciSQL(sentencia);
            objConexion.desconectar();
        } catch (Exception e) {
            System.err.println("Error en btn agregar procto "+e);
        }
        
    }//GEN-LAST:event_btnAgregarProductoActionPerformed

    //con este medoto obtenemos cada txt que hay en la vista
    public Proveedor recuperarDatosGUI() {//recuperamso datos y los seteamos al objProveedor que
        //tiene una lista de obj de datos //ya que puede tener dos tel y dos dircc
        Proveedor objProveedor = new Proveedor();
        objProveedor.setId_proveedor(Long.parseLong(txtIdProveedor.getText()));
        objProveedor.setNombre(txtNombre.getText());
        objProveedor.setNit(txtNit.getText());
        
        DatosContacto datos = new DatosContacto();
        datos.setDireccion(txtDireccionUno.getText());
        if (!txtTelefonoUno.getText().isEmpty()) {//debo validar que este vacio, porque si no al convertir un vacio se genera error
            datos.setTelefono(Long.parseLong(txtTelefonoUno.getText()));
        }
        objProveedor.agregarDatos(datos);
        
        datos = new DatosContacto();
        datos.setDireccion(txtDireccionDos.getText());
        if (!txtTelefonoDos.getText().isEmpty()) {
            datos.setTelefono(Integer.parseInt(txtTelefonoDos.getText()));
        }
        objProveedor.agregarDatos(datos);
        return objProveedor;
    }
    
    public void cargarProductos(){
        while(modelProductos.getRowCount() > 0){
            modelProductos.removeRow(0);//limpia la tabla
        }
        Conexion objConexion = new Conexion();
        try {
            ResultSet respuesta = objConexion.consultarRegistro("Select * from producto");
            while(respuesta.next()){
                Producto producto = new Producto();
                producto.setId_producto(Long.parseLong(respuesta.getString("id_producto")));
                producto.setCodigo(respuesta.getString("codigo"));
                producto.setNombre(respuesta.getString("nombre"));
                producto.setCantidad(Double.parseDouble(respuesta.getString("cantidad")));
                producto.setPrecio(Double.parseDouble(respuesta.getString("precio")));
                producto.setCategoria(respuesta.getString("categoria"));
                Object [] objProducto = {producto.getId_producto(),producto.getCodigo(),producto.getNombre(),producto.getCantidad(),producto.getPrecio(),producto.getCategoria()};
                modelProductos.addRow(objProducto);
            }
        } catch (Exception e) {
            System.err.println("inventario: error "+e);
        }
    }
    
    public void cargarDatos() {
        while(model.getRowCount() > 0){//limpiar la tabla y se agrega
            model.removeRow(0);
        }
        Conexion objConexion = new Conexion();
        this.listProveedores = new ArrayList();
        try {
//            ResultSet respuesta = objConexion.consultarRegistro("SELECT p.id_proveedor, p.nombre, p.nit, d.telefono, d.direccion FROM proveedor AS p INNER JOIN datoscontacto AS d ON p.id_proveedor = d.id_proveedor");
            ResultSet respuestaProveedor = objConexion.consultarRegistro("SELECT * FROM proveedor ");
            
            while (respuestaProveedor.next()) {//recorremos uno a uno los proveedores
                Proveedor proveedor = new Proveedor();//los guardamos en este objeto
                proveedor.setId_proveedor(Long.parseLong(respuestaProveedor.getString("id_proveedor")));
                proveedor.setNombre(respuestaProveedor.getString("nombre"));
                proveedor.setNit(respuestaProveedor.getString("nit"));
                
                ResultSet respuestadatos = objConexion.consultarRegistro("SELECT * FROM datoscontacto where id_proveedor = " + Long.parseLong(respuestaProveedor.getString("id_proveedor")));
                String telefonos = "";
                String direcciones = "";
                while (respuestadatos.next()) {//ahora recorremos uno a uno los datos que tenga ese proveedor 
                    DatosContacto datos = new DatosContacto();//llenamos los datos en el objeto
                    datos.setTelefono(Long.parseLong(respuestadatos.getString("telefono")));
                    datos.setDireccion(respuestadatos.getString("direccion"));
                    proveedor.agregarDatos(datos); // lo agregamos al objeto programador 
                    //de esta manera el objeto programador ya tiene la lista con telefono y dirección
                    //aqui concatenamos para pasar los datos al Object [] y sea visible en la tabla

                    telefonos = respuestadatos.getString("telefono") + " \n " + telefonos;
                    direcciones = respuestadatos.getString("direccion") + " \n " + direcciones;
                }
                //agragamos cada proveedor a una lista de proveedores
                listProveedores.add(proveedor);
                Object[] objProveedor = {respuestaProveedor.getString("id_proveedor"), respuestaProveedor.getString("nit"), respuestaProveedor.getString("nombre"), direcciones, telefonos};//,respuesta.getString("direccion"),respuesta.getString("telefono")
                model.addRow(objProveedor);
            }
            

            //este for es para ver que si se guardaron correctamente los datos en la lista 
//            for (Proveedor lista : listProveedores) {
//                System.out.println(lista.toString());
//                for (int i = 0; i < lista.getDatos().size(); i++) {
//                    System.out.println("Dirección: " + lista.getDatos().get(i).getDireccion());                    
//                    System.out.println("Telefono: " + lista.getDatos().get(i).getTelefono());                    
//                }
//            }
            objConexion.desconectar();
        } catch (Exception e) {
            System.out.println("Se presento un error al cargar datos " + e);
        }
        
    }
    
     private void iniciarTabla() {
//        while(model.getRowCount() > 0){
//            model.removeRow(0);
//        }
        Conexion objConexion = new Conexion();
        this.listProveedores = new ArrayList();
        TablaModelo modelo = new TablaModelo();
        try {
            ResultSet respuestaProveedor = objConexion.consultarRegistro("SELECT * FROM proveedor ");
            
            while (respuestaProveedor.next()) {//recorremos uno a uno los proveedores
                Proveedor proveedor = new Proveedor();//los guardamos en este objeto
                proveedor.setId_proveedor(Long.parseLong(respuestaProveedor.getString("id_proveedor")));
                proveedor.setNombre(respuestaProveedor.getString("nombre"));
                proveedor.setNit(respuestaProveedor.getString("nit"));
                
                ResultSet respuestadatos = objConexion.consultarRegistro("SELECT * FROM datoscontacto where id_proveedor = " + Long.parseLong(respuestaProveedor.getString("id_proveedor")));
                String telefonos = "";
                String direcciones = "";
                while (respuestadatos.next()) {//ahora recorremos uno a uno los datos que tenga ese proveedor 
                    DatosContacto datos = new DatosContacto();//llenamos los datos en el objeto
                    datos.setTelefono(Long.parseLong(respuestadatos.getString("telefono")));
                    datos.setDireccion(respuestadatos.getString("direccion"));
                    proveedor.agregarDatos(datos); // lo agregamos al objeto programador 
                    //de esta manera el objeto programador ya tiene la lista con telefono y dirección
                    //aqui concatenamos para pasar los datos al Object [] y sea visible en la tabla
                    
                    telefonos = respuestadatos.getString("telefono") + " \n " + telefonos;
                    direcciones = respuestadatos.getString("direccion") + " \n " + direcciones;
                }
                
                //agragamos cada proveedor a una lista de proveedores
                listProveedores.add(proveedor);
                
            }
//            modelo.addProveedor(this.listProveedores.get(0));
//            modelo.addProveedor(this.listProveedores.get(0));
//            modelo.addProveedor(this.listProveedores.get(1));
            
            //este for es para ver que si se guardaron correctamente los datos en la lista 
            for (Proveedor objProveedor : listProveedores) {
//                System.out.println(objProveedor.toString());
                modelo.addProveedor(objProveedor);
                for (int i = 0; i < objProveedor.getDatos().size(); i++) {
                    System.out.println("Dirección: " + objProveedor.getDatos().get(i).getDireccion());                    
                }
                for (int i = 0; i < objProveedor.getDatos().size(); i++) {
                    System.out.println("Telefono: " + objProveedor.getDatos().get(i).getTelefono());                    
                }
            }
            
            
            tblProveedores.setModel(modelo);
            tblProveedores.getTableHeader().setDefaultRenderer(new EncabezadoRenderer());
            
            TableColumnModel tcm = tblProveedores.getColumnModel();
            for (int it = 0; it < tcm.getColumnCount(); it++) {
                tcm.getColumn(it).setCellRenderer(new CeldaRenderer());
            }
            
        } catch (Exception e) {
            System.out.println("Se presento un error al cargar datos " + e);
        }
    }

     public void limpiar(){
         txtIdProveedor.setText("");
         txtNombre.setText("");
         txtNit.setText("");
         txtTelefonoUno.setText("");
         txtTelefonoDos.setText("");
         txtDireccionUno.setText("");
         txtDireccionDos.setText("");
         btnAgregar.setEnabled(true);
         btnEditar.setEnabled(false);
         btnCancelar.setEnabled(true);
     }
     
    /**
     * @param args the command line arguments
     */
    public static void main(String args[]) {
        /* Set the Nimbus look and feel */
        //<editor-fold defaultstate="collapsed" desc=" Look and feel setting code (optional) ">
        /* If Nimbus (introduced in Java SE 6) is not available, stay with the default look and feel.
         * For details see http://download.oracle.com/javase/tutorial/uiswing/lookandfeel/plaf.html 
         */
        try {
            for (javax.swing.UIManager.LookAndFeelInfo info : javax.swing.UIManager.getInstalledLookAndFeels()) {
                if ("Nimbus".equals(info.getName())) {
                    javax.swing.UIManager.setLookAndFeel(info.getClassName());
                    break;
                }
            }
        } catch (ClassNotFoundException ex) {
            java.util.logging.Logger.getLogger(FormProveedor.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (InstantiationException ex) {
            java.util.logging.Logger.getLogger(FormProveedor.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (IllegalAccessException ex) {
            java.util.logging.Logger.getLogger(FormProveedor.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        } catch (javax.swing.UnsupportedLookAndFeelException ex) {
            java.util.logging.Logger.getLogger(FormProveedor.class.getName()).log(java.util.logging.Level.SEVERE, null, ex);
        }
        //</editor-fold>

        /* Create and display the form */
        java.awt.EventQueue.invokeLater(new Runnable() {
            public void run() {
                new FormProveedor().setVisible(true);
            }
        });
    }

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btnAgregar;
    private javax.swing.JButton btnAgregarProducto;
    private javax.swing.JButton btnCancelar;
    private javax.swing.JButton btnEditar;
    private javax.swing.JButton btnVolver;
    private javax.swing.JButton jButton2;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel10;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JLabel jLabel9;
    private javax.swing.JScrollPane jScrollPane1;
    private javax.swing.JScrollPane jScrollPane2;
    private javax.swing.JPanel pnlAgregarProductos;
    private javax.swing.JPanel pnlAgregarProveedor;
    private javax.swing.JTable tblProductos;
    private javax.swing.JTable tblProveedores;
    private javax.swing.JTextField txtCodigoProducto;
    private javax.swing.JTextField txtDireccionDos;
    private javax.swing.JTextField txtDireccionUno;
    private javax.swing.JTextField txtIdProveedor;
    private javax.swing.JTextField txtNit;
    private javax.swing.JTextField txtNombre;
    private javax.swing.JTextField txtTelefonoDos;
    private javax.swing.JTextField txtTelefonoUno;
    // End of variables declaration//GEN-END:variables
}
